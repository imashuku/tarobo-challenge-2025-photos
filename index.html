<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tarobo Faces - Random 30 Slideshow</title>
  <style>
    :root { --fade-ms: 1200; --show-ms: 2500; }
    html,body,#stage{height:100%;margin:0;background:#000}
    #stage{position:relative;overflow:hidden;touch-action:none}
    .slide{
      position:absolute; inset:0;
      width:100%; height:100%; object-fit:cover;
      opacity:0;
      transition:opacity 1200ms ease-in-out;
      will-change: opacity;
    }
    .slide.active{opacity:1}
    #hud{
      position:fixed; left:12px; bottom:12px; z-index:25;
      color:#fff; font:12px/1.4 system-ui,-apple-system,Segoe UI,Roboto;
      background:rgba(0,0,0,.35); padding:8px 10px; border-radius:10px;
      backdrop-filter: blur(6px);
      display:flex; flex-wrap:wrap; gap:8px; align-items:center;
      max-width:calc(100vw - 200px);
      transition:bottom 0.3s ease;
    }
    #hud.raised{
      bottom:152px; /* ã‚µãƒ ãƒã‚¤ãƒ«é«˜ã•140px + ä½™ç™½12px */
    }
    button{border:1px solid #666; background:#111; color:#fff; padding:6px 10px; border-radius:8px; cursor:pointer; margin:0}
    button:hover{background:#333; border-color:#888}
    button:active{background:#000}
    button.active{background:#0066cc; border-color:#0066cc}
    a{color:#8bdcff}

    /* ç”»åƒæƒ…å ±è¡¨ç¤º */
    #image-info{
      position:fixed; top:12px; right:12px; z-index:10;
      color:#fff; font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto;
      background:rgba(0,0,0,.35); padding:10px 14px; border-radius:10px;
      backdrop-filter: blur(6px);
    }
    #counter{font-size:20px; font-weight:bold; margin-bottom:4px}
    #filename{font-size:12px; opacity:0.8; max-width:200px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap}

    /* é€²æ—ãƒãƒ¼ */
    #progress-bar{
      position:fixed; top:0; left:0; right:0; height:3px; z-index:20;
      background:rgba(255,255,255,0.1);
    }
    #progress-fill{
      height:100%; width:0%; background:linear-gradient(90deg, #0066cc, #00ccff);
      transition:width 100ms linear;
    }

    /* ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
    #speed-controls{
      display:flex; gap:4px;
    }
    #speed-controls button{
      min-width:45px;
    }

    /* ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒ˜ãƒ«ãƒ— */
    #help-btn{
      position:fixed; top:12px; left:12px; z-index:10;
      width:40px; height:40px; border-radius:50%;
      background:rgba(0,0,0,0.35); border:1px solid #666;
      color:#fff; font-size:20px; cursor:pointer;
      backdrop-filter: blur(6px);
      transition: all 0.3s ease;
      display:flex; align-items:center; justify-content:center;
    }
    #help-btn:hover{
      transform:scale(1.05);
      background:rgba(0,0,0,0.5);
      border-color:#888;
    }
    #help-panel{
      position:fixed; top:60px; left:12px; z-index:10;
      color:#fff; font:12px/1.6 system-ui,-apple-system,Segoe UI,Roboto;
      background:rgba(0,0,0,0.85); padding:12px 16px; border-radius:10px;
      backdrop-filter: blur(10px);
      border:1px solid #666;
      max-width:320px;
      display:none;
    }
    #help-panel.show{ display:block; }
    #help-panel h3{
      margin:0 0 8px 0; font-size:14px; font-weight:bold;
    }
    #help-panel ul{
      margin:0; padding:0; list-style:none;
    }
    #help-panel li{
      margin:4px 0; padding:4px 0;
    }
    #help-panel strong{
      color:#8bdcff; font-weight:normal;
      display:inline-block; min-width:80px;
    }

    /* Aboutãƒœã‚¿ãƒ³ */
    #about-btn{
      position:fixed; top:12px; left:60px; z-index:10;
      width:40px; height:40px; border-radius:50%;
      background:rgba(0,0,0,0.35); border:1px solid #666;
      color:#fff; font-size:20px; cursor:pointer;
      backdrop-filter: blur(6px);
      transition: all 0.3s ease;
      display:flex; align-items:center; justify-content:center;
    }
    #about-btn:hover{
      transform:scale(1.05);
      background:rgba(0,0,0,0.5);
      border-color:#888;
    }
    #about-panel{
      position:fixed; top:60px; left:60px; z-index:10;
      color:#fff; font:12px/1.6 system-ui,-apple-system,Segoe UI,Roboto;
      background:rgba(0,0,0,0.85); padding:12px 16px; border-radius:10px;
      backdrop-filter: blur(10px);
      border:1px solid #666;
      max-width:360px;
      display:none;
    }
    #about-panel.show{ display:block; }
    #about-panel h3{
      margin:0 0 12px 0; font-size:14px; font-weight:bold;
    }
    #about-panel p{
      margin:8px 0;
      line-height:1.6;
    }
    #about-panel .tagline{
      font-size:11px;
      color:#999;
      margin-top:12px;
      padding-top:8px;
      border-top:1px solid #444;
    }


    /* ã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°ç”»é¢ */
    #opening{
      position:fixed; inset:0; z-index:200;
      background:#000;
      display:flex; align-items:center; justify-content:center;
      opacity:1;
      transition:opacity 0.8s ease;
    }
    #opening.hide{ opacity:0; pointer-events:none; }
    #opening-content{
      text-align:center; color:#fff;
      max-width:600px; padding:40px;
    }
    #opening-logo{
      width:120px; height:auto;
      margin:0 auto 24px auto;
      display:block;
      opacity:0.9;
    }
    #opening h1{
      font-size:28px; font-weight:bold; margin:0 auto 16px auto;
      line-height:1.6;
      text-align:center;
      width:100%;
    }
    #opening .sub{
      font-size:16px; color:#999; margin:0 0 32px 0;
    }
    #opening .tagline{
      font-size:14px; margin:32px 0;
      padding:16px 0; border-top:1px solid #333; border-bottom:1px solid #333;
    }
    #opening-start{
      background:rgba(255,255,255,0.1); border:1px solid #666;
      color:#fff; padding:12px 32px; border-radius:8px;
      font-size:16px; cursor:pointer;
      transition:all 0.3s;
      margin-top:24px;
    }
    #opening-start:hover{
      background:rgba(255,255,255,0.2); border-color:#888;
      transform:scale(1.05);
    }
    #opening-skip{
      background:transparent; border:none;
      color:#666; padding:8px; margin-top:16px;
      font-size:12px; cursor:pointer;
    }
    #opening-skip:hover{ color:#999; }

    /* ã„ã„ã­ãƒœã‚¿ãƒ³ */
    #like-btn{
      position:fixed; right:12px; bottom:80px; z-index:15;
      width:50px; height:50px; border-radius:10px;
      background:rgba(0,0,0,0.35); border:1px solid #666;
      color:#fff; font-size:24px; cursor:pointer;
      backdrop-filter: blur(6px);
      transition: all 0.3s ease;
    }
    #like-btn:hover{
      transform:scale(1.05);
      background:rgba(0,0,0,0.5);
      border-color:#888;
    }
    #like-btn:active{ transform:scale(0.95); }
    #like-btn.liked{ animation: heartBeat 0.3s ease; }
    @keyframes heartBeat {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }
    #like-count{
      position:absolute; top:-6px; right:-6px;
      background:rgba(0,102,204,0.9); color:#fff; font-size:11px; font-weight:bold;
      padding:2px 5px; border-radius:8px; min-width:18px; text-align:center;
      border:1px solid rgba(255,255,255,0.2);
    }

    /* SNSã‚·ã‚§ã‚¢ãƒœã‚¿ãƒ³ */
    #share-btns{
      position:fixed; right:12px; bottom:140px; z-index:15;
      display:flex; flex-direction:column; gap:6px;
    }
    .share-btn{
      width:50px; height:50px; border-radius:10px;
      border:1px solid #666; cursor:pointer; font-size:18px;
      transition: all 0.3s ease;
      background:rgba(0,0,0,0.35);
      color:#fff;
      backdrop-filter: blur(6px);
      display:flex; align-items:center; justify-content:center;
    }
    .share-btn:hover{
      transform:scale(1.05);
      background:rgba(0,0,0,0.5);
      border-color:#888;
    }
    .share-btn:active{ transform:scale(0.95); }

    /* ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆç”»åƒæ‹¡å¤§è¡¨ç¤ºï¼‰ */
    #modal{
      display:none; position:fixed; inset:0; z-index:100;
      background:rgba(0,0,0,0.95); cursor:zoom-out;
      align-items:center; justify-content:center;
    }
    #modal.show{ display:flex; }
    #modal img{
      max-width:90%; max-height:90%; object-fit:contain;
      box-shadow: 0 8px 32px rgba(0,0,0,0.5);
    }
    #modal-close{
      position:absolute; top:20px; right:20px;
      background:rgba(255,255,255,0.2); border:none;
      color:#fff; font-size:30px; width:50px; height:50px;
      border-radius:50%; cursor:pointer;
      backdrop-filter: blur(6px);
    }
    #modal-close:hover{ background:rgba(255,255,255,0.3); }

    /* ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé¸æŠ */
    #effect-selector{
      display:flex;
    }
    #effect-selector select{
      background:#111; color:#fff; border:1px solid #666;
      padding:6px 8px; border-radius:8px; cursor:pointer;
      font:12px/1.4 system-ui,-apple-system,Segoe UI,Roboto;
    }
    #effect-selector select:hover{ border-color:#888; background:#333; }

    /* BGMã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
    #bgm-controls{
      display:flex; gap:6px; align-items:center;
    }
    #bgm-toggle{
      background:#111; border:1px solid #666;
      color:#fff; padding:6px 10px; border-radius:8px; cursor:pointer;
      white-space:nowrap;
    }
    #bgm-toggle.playing{ background:#0066cc; border-color:#0066cc; }
    #bgm-volume{
      width:60px;
    }

    /* ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¨ãƒ•ã‚§ã‚¯ãƒˆç”¨ */
    .slide.effect-slide-left{
      transform:translateX(-100%);
      transition:opacity var(--fade-ms)ms linear, transform var(--fade-ms)ms ease-out;
    }
    .slide.effect-slide-left.active{ transform:translateX(0); }

    .slide.effect-slide-right{
      transform:translateX(100%);
      transition:opacity var(--fade-ms)ms linear, transform var(--fade-ms)ms ease-out;
    }
    .slide.effect-slide-right.active{ transform:translateX(0); }

    .slide.effect-zoom{
      transform:scale(0.8);
      transition:opacity var(--fade-ms)ms linear, transform var(--fade-ms)ms ease-out;
    }
    .slide.effect-zoom.active{ transform:scale(1); }

    .slide.effect-rotate{
      transform:rotate(-5deg) scale(0.9);
      transition:opacity var(--fade-ms)ms linear, transform var(--fade-ms)ms ease-out;
    }
    .slide.effect-rotate.active{ transform:rotate(0deg) scale(1); }

    /* ã‚µãƒ ãƒã‚¤ãƒ«ä¸€è¦§ */
    #thumbnails-container{
      position:fixed; bottom:0; left:0; right:0; height:0; z-index:20;
      background:rgba(0,0,0,0.9); backdrop-filter:blur(10px);
      transition:height 0.3s ease;
      overflow:hidden;
    }
    #thumbnails-container.show{ height:140px; }
    #thumbnails-wrapper{
      display:flex; gap:8px; padding:12px;
      overflow-x:auto; overflow-y:hidden; height:100%;
      align-items:center;
    }
    #thumbnails-wrapper::-webkit-scrollbar{ height:8px; }
    #thumbnails-wrapper::-webkit-scrollbar-track{ background:rgba(255,255,255,0.1); }
    #thumbnails-wrapper::-webkit-scrollbar-thumb{
      background:rgba(255,255,255,0.3); border-radius:4px;
    }
    .thumbnail{
      flex-shrink:0; width:100px; height:100px;
      object-fit:cover; border-radius:8px; cursor:pointer;
      border:2px solid transparent; transition:all 0.2s ease;
      position:relative;
    }
    .thumbnail:hover{
      transform:scale(1.1); border-color:#888;
    }
    .thumbnail.active{
      border-color:#0066cc; box-shadow:0 0 12px rgba(0,102,204,0.6);
    }
    .thumbnail.liked::after{
      content:'ğŸ¤'; position:absolute; top:4px; right:4px;
      font-size:16px; text-shadow:0 0 4px rgba(0,0,0,0.8);
    }

    /* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒœã‚¿ãƒ³ */
    #filter-controls{
      position:fixed; top:50%; right:12px; transform:translateY(-50%); z-index:15;
      display:flex; flex-direction:column; gap:6px;
    }
    #filter-all, #filter-liked{
      width:50px; height:50px; border-radius:10px;
      border:1px solid #666; cursor:pointer;
      background:rgba(0,0,0,0.35); color:#fff;
      backdrop-filter:blur(6px); transition:all 0.3s ease;
      display:flex; align-items:center; justify-content:center;
      font-size:20px;
    }
    #filter-all:hover, #filter-liked:hover{
      transform:scale(1.05); background:rgba(0,0,0,0.5); border-color:#888;
    }
    #filter-all.active, #filter-liked.active{
      background:#0066cc; border-color:#0066cc;
    }
  </style>
</head>
<body>
  <div id="progress-bar"><div id="progress-fill"></div></div>
  <div id="stage" aria-label="ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼é ˜åŸŸ"></div>

  <!-- ã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°ç”»é¢ -->
  <div id="opening">
    <div id="opening-content">
      <img src="tarobo-logo-white.png" alt="TAROBO CHALLENGE" id="opening-logo">
      <h1>æ­´å²ã‚’é§†ã‘æŠœã‘ã€æœªæ¥ã‚’æ´ã‚</h1>
      <p class="sub">æ´ã‚“ã æ‰‹ã™ã‚Šã«æ®‹ã‚‹ã®ã¯ã€å·±ã®æ±—ã¨æŒ‘æˆ¦ã—ç¶šã‘ã‚‹æ„æ€</p>
      <p class="tagline">å¤ªéƒåŠãƒãƒ£ãƒ¬ãƒ³ã‚¸ 2025<br>æ´ã‚€ã€ãã®ç¬é–“ã®è¨˜éŒ²</p>
      <button id="opening-start" title="ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ã‚’é–‹å§‹ã—ã¾ã™">ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ã‚’è¦‹ã‚‹ â†’</button>
      <br>
      <button id="opening-skip" title="ã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ã™ãã«é–‹å§‹ã—ã¾ã™">Skip</button>
    </div>
  </div>

  <!-- ãƒ˜ãƒ«ãƒ—ãƒœã‚¿ãƒ³ -->
  <button id="help-btn" title="ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã‚’è¡¨ç¤º">?</button>
  <div id="help-panel">
    <h3>âŒ¨ï¸ ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œ</h3>
    <ul>
      <li><strong>Space</strong> ä¸€æ™‚åœæ­¢ / å†ç”Ÿ</li>
      <li><strong>â† â†’</strong> å‰å¾Œã®ç”»åƒã«ç§»å‹•</li>
      <li><strong>â†‘ â†“</strong> é€Ÿåº¦å¤‰æ›´</li>
      <li><strong>L</strong> ã„ã„ã­</li>
      <li><strong>Enter</strong> ç”»åƒã‚’æ‹¡å¤§è¡¨ç¤º</li>
      <li><strong>Esc</strong> é–‰ã˜ã‚‹</li>
      <li><strong>T</strong> å†™çœŸä¸€è¦§ã®è¡¨ç¤ºåˆ‡æ›¿</li>
      <li><strong>F</strong> ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼åˆ‡æ›¿</li>
    </ul>
  </div>

  <!-- Aboutãƒœã‚¿ãƒ³ -->
  <button id="about-btn" title="ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¤ã„ã¦">â“˜</button>
  <div id="about-panel">
    <h3>About this project</h3>
    <p>å¤ªéƒåŠãƒãƒ£ãƒ¬ãƒ³ã‚¸ã®ã‚¹ãƒ­ãƒ¼ã‚¬ãƒ³ã¯<br>ã€Œ<strong>æ­´å²ã‚’é§†ã‘æŠœã‘ã€æœªæ¥ã‚’æ´ã‚ï¼</strong>ã€</p>
    <p>379æ®µã®çŸ³æ®µã‚’é§†ã‘ä¸ŠãŒã‚‹å‚åŠ è€…ä¸€äººã²ã¨ã‚Šã®"ã‚ã¨30mã®è¡¨æƒ…"ã‚’è¨˜éŒ²ã—ã¾ã—ãŸã€‚</p>
    <p>å†™ã£ã¦ã„ã‚‹ã®ã¯ã€ãŸã ã®é¡”ã§ã¯ãªãã€é™ç•Œã‚’è¶…ãˆã‚‹ç¬é–“ã®æ„æ€ã§ã™ã€‚</p>
    <p>æ’®å½±ã¯ä¸€äººã®ã‚«ãƒ¡ãƒ©ãƒãƒ³ãŒã€ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã§ä¸€æ—¥ä¸­è¿½ã„ç¶šã‘ã¾ã—ãŸã€‚ã™ã¹ã¦ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ£ãƒ¼ã‚’æ’®ã‚Šåˆ‡ã‚ŒãŸã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€å†™ã‚‰ãªã‹ã£ãŸäººã®æŒ‘æˆ¦ã‚‚ã€ç§ãŸã¡ã®è¨˜æ†¶ã®ä¸­ã«ç¢ºã‹ã«åˆ»ã¾ã‚Œã¦ã„ã¾ã™ã€‚</p>
    <p>ã“ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ã¯ã€è†¨å¤§ãªã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«é¸ã°ã‚ŒãŸ50æšã‚’è¡¨ç¤ºã—ã¾ã™ã€‚ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã€ã¾ãŸã¯ğŸ”„ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ãŸã³ã€æ–°ãŸãª50ã®è¡¨æƒ…ã¨å‡ºä¼šãˆã¾ã™ã€‚</p>
    <p class="tagline">ã“ã‚Œã¯ã€æœªæ¥ã‚’æ´ã‚‚ã†ã¨ã—ãŸå…¨ã¦ã®äººã®è¨˜éŒ²ã§ã™ã€‚</p>
  </div>

  <div id="image-info">
    <div id="counter">-/-</div>
    <div id="filename">-</div>
  </div>

  <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒœã‚¿ãƒ³ -->
  <div id="filter-controls">
    <button id="filter-all" class="active" title="å…¨ã¦ã®å†™çœŸã‚’è¡¨ç¤ºã—ã¾ã™">ğŸ“·</button>
    <button id="filter-liked" title="ã„ã„ã­ã—ãŸå†™çœŸã ã‘ã‚’è¡¨ç¤ºã—ã¾ã™">ğŸ¤</button>
  </div>

  <!-- ã„ã„ã­ãƒœã‚¿ãƒ³ -->
  <button id="like-btn" title="ã“ã®å†™çœŸã«ã„ã„ã­ï¼ï¼ˆLã‚­ãƒ¼ï¼‰">
    ğŸ©¶
    <span id="like-count">0</span>
  </button>

  <!-- SNSã‚·ã‚§ã‚¢ãƒœã‚¿ãƒ³ -->
  <div id="share-btns">
    <button class="share-btn" id="share-twitter" title="ã“ã®å†™çœŸã‚’Twitterã§ã‚·ã‚§ã‚¢">ğ•</button>
    <button class="share-btn" id="share-facebook" title="ã“ã®å†™çœŸã‚’Facebookã§ã‚·ã‚§ã‚¢">f</button>
    <button class="share-btn" id="share-line" title="ã“ã®å†™çœŸã‚’LINEã§ã‚·ã‚§ã‚¢">L</button>
  </div>

  <!-- ã‚µãƒ ãƒã‚¤ãƒ«ä¸€è¦§ -->
  <div id="thumbnails-container">
    <div id="thumbnails-wrapper"></div>
  </div>

  <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆç”»åƒæ‹¡å¤§ï¼‰ -->
  <div id="modal">
    <button id="modal-close">Ã—</button>
    <img id="modal-img" src="" alt="æ‹¡å¤§ç”»åƒ">
  </div>

  <div id="hud">
    <button id="thumbnails-toggle" title="å…¨ã¦ã®å†™çœŸã‚’ä¸€è¦§è¡¨ç¤ºã—ã¾ã™ï¼ˆTã‚­ãƒ¼ï¼‰">ğŸ“¸ å†™çœŸä¸€è¦§</button>
    <div id="bgm-controls">
      <button id="bgm-toggle" title="BGMã‚’ON/OFFã—ã¾ã™">ğŸµ BGM</button>
      <input type="range" id="bgm-volume" min="0" max="100" value="50" title="BGMã®éŸ³é‡ã‚’èª¿æ•´ã—ã¾ã™">
    </div>
    <div id="effect-selector">
      <select id="effect-select" title="ç”»åƒåˆ‡ã‚Šæ›¿ãˆæ™‚ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’é¸æŠã—ã¾ã™">
        <option value="fade">ãƒ•ã‚§ãƒ¼ãƒ‰</option>
        <option value="slide-left">ã‚¹ãƒ©ã‚¤ãƒ‰å·¦</option>
        <option value="slide-right">ã‚¹ãƒ©ã‚¤ãƒ‰å³</option>
        <option value="zoom">ã‚ºãƒ¼ãƒ </option>
        <option value="rotate">å›è»¢</option>
        <option value="random">ãƒ©ãƒ³ãƒ€ãƒ </option>
      </select>
    </div>
    <div id="speed-controls">
      <button id="btn-speed-slow" title="ã‚¹ãƒ­ãƒ¼ãƒ¢ãƒ¼ãƒ‰ï¼š5ç§’ã”ã¨ã«åˆ‡ã‚Šæ›¿ãˆï¼ˆâ†“ã‚­ãƒ¼ï¼‰">ğŸ¢</button>
      <button id="btn-speed-normal" class="active" title="é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼š2.5ç§’ã”ã¨ã«åˆ‡ã‚Šæ›¿ãˆ">â–¶ï¸</button>
      <button id="btn-speed-fast" title="æ—©é€ã‚Šãƒ¢ãƒ¼ãƒ‰ï¼š1ç§’ã”ã¨ã«åˆ‡ã‚Šæ›¿ãˆï¼ˆâ†‘ã‚­ãƒ¼ï¼‰">ğŸ‡</button>
    </div>
    <button id="btn-play" title="ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ã‚’å†ç”Ÿã—ã¾ã™ï¼ˆSpaceã‚­ãƒ¼ï¼‰">Play</button>
    <button id="btn-pause" title="ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ã‚’ä¸€æ™‚åœæ­¢ã—ã¾ã™ï¼ˆSpaceã‚­ãƒ¼ï¼‰">Pause</button>
    <button id="btn-refresh" title="å†™çœŸã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦æœ€åˆã‹ã‚‰å†ç”Ÿã—ã¾ã™">ğŸ”„ Shuffle</button>
    <span id="info">loadingâ€¦</span>
  </div>

  <!-- BGMç”¨ã®ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªè¦ç´  -->
  <audio id="bgm-audio" loop>
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
  </audio>

  <script>
  // ===== è¨­å®š =====
  const FOLDER_ID = '1SjdlmWER2n6kRT0CB0zuO4OmIrnc9aR1';
  const API_KEY = 'AIzaSyC-a2EarD9wlaV2w6CYdKl48fznBdzf9v0'; // â† Google Cloud Consoleã§APIã‚­ãƒ¼ã‚’ä½œæˆã—ã¦è¨­å®šã—ã¦ãã ã•ã„
  // APIã‚­ãƒ¼ã®å–å¾—æ–¹æ³•: https://console.cloud.google.com/apis/credentials
  // å¿…è¦ãªAPI: Google Drive API v3

  const COUNT = 50;     // è¡¨ç¤ºæšæ•°
  const FADE_MS = 1200;  // ãƒ•ã‚§ãƒ¼ãƒ‰æ™‚é–“
  const PRELOAD_COUNT = 2;

  // ã‚¹ãƒ”ãƒ¼ãƒ‰è¨­å®š
  const SPEEDS = {
    slow: 6000,
    normal: 3500,
    fast: 1500
  };

  let SHOW_MS = SPEEDS.normal;
  let currentSpeed = 'normal';

  document.documentElement.style.setProperty('--fade-ms', FADE_MS);
  document.documentElement.style.setProperty('--show-ms', SHOW_MS);

  let slides = [], idx = 0, timer = null, running = false, progressTimer = null;
  let fileList = []; // ãƒ•ã‚¡ã‚¤ãƒ«åä¿å­˜ç”¨
  let currentEffect = 'fade'; // ç¾åœ¨ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
  let likedImages = new Set(); // ã„ã„ã­ã—ãŸç”»åƒã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
  let imageLikeCounts = {}; // å„ç”»åƒã®ã„ã„ã­æ•°ã‚’ä¿å­˜ {index: count}
  let bgmAudio = null; // BGMã‚ªãƒ¼ãƒ‡ã‚£ã‚ªè¦ç´ 
  let allSlides = []; // å…¨ã‚¹ãƒ©ã‚¤ãƒ‰ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
  let currentFilter = 'all'; // ç¾åœ¨ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼çŠ¶æ…‹
  let thumbnailsVisible = false; // ã‚µãƒ ãƒã‚¤ãƒ«è¡¨ç¤ºçŠ¶æ…‹

  // Google Driveãƒ•ã‚©ãƒ«ãƒ€IDã‹ã‚‰ç”»åƒãƒªã‚¹ãƒˆã‚’å–å¾—ï¼ˆãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œï¼‰
  async function fetchList(){
    if (API_KEY === 'YOUR_GOOGLE_API_KEY_HERE') {
      throw new Error('APIã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„');
    }

    let allFiles = [];
    let pageToken = null;

    // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã§å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—
    do {
      const params = {
        q: `'${FOLDER_ID}' in parents and (mimeType contains 'image/')`,
        key: API_KEY,
        fields: 'files(id,name,mimeType,webContentLink),nextPageToken',
        pageSize: '1000',
        orderBy: 'name'
      };

      if (pageToken) {
        params.pageToken = pageToken;
      }

      const url = `https://www.googleapis.com/drive/v3/files?` + new URLSearchParams(params);

      console.log(`Fetching page... (current total: ${allFiles.length})`);

      const res = await fetch(url);
      if (!res.ok) {
        const error = await res.json();
        console.error('Google Drive API Error:', error);
        throw new Error(`API Error: ${error.error?.message || 'Unknown error'}`);
      }

      const data = await res.json();
      const files = data.files || [];

      allFiles = allFiles.concat(files);
      pageToken = data.nextPageToken;

      console.log(`Fetched ${files.length} files. Total: ${allFiles.length}`);

    } while (pageToken); // nextPageTokenãŒã‚ã‚‹é™ã‚Šç¶šã‘ã‚‹

    console.log(`âœ… All files fetched: ${allFiles.length} images`);

    // ãƒ©ãƒ³ãƒ€ãƒ ã«ã‚·ãƒ£ãƒƒãƒ•ãƒ«
    const shuffled = allFiles.sort(() => Math.random() - 0.5);

    // ç”»åƒURLã‚’ç”Ÿæˆï¼ˆå…¬é–‹ãƒ•ã‚©ãƒ«ãƒ€ã®å ´åˆï¼‰
    const pick = shuffled.slice(0, COUNT).map(f => ({
      url: `https://drive.google.com/thumbnail?id=${f.id}&sz=w2000`,
      name: f.name,
      id: f.id
    }));

    return { all: allFiles.length, pick };
  }

  function createSlides(list){
    const stage = document.getElementById('stage');
    stage.innerHTML = '';
    slides = [];
    fileList = list; // ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’ä¿å­˜
    let added = 0;
    list.forEach((f, i) => {
      if (added >= COUNT) return;
      const img = document.createElement('img');
      img.src = f.url;
      img.alt = f.name || `photo-${i+1}`;
      img.className = 'slide';
      img.dataset.index = i; // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä¿å­˜
      if (i >= PRELOAD_COUNT) img.loading = 'lazy';
      img.onerror = () => { img.remove(); }; // 403ç­‰ã¯é™¤å»
      img.onload = () => { added++; };       // èª­ã‚ãŸã‚‚ã®ã ã‘ã‚«ã‚¦ãƒ³ãƒˆ
      stage.appendChild(img);
      slides.push(img);
    });
    allSlides = [...slides]; // å…¨ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ä¿å­˜
    createThumbnails(list); // ã‚µãƒ ãƒã‚¤ãƒ«ã‚’ç”Ÿæˆ
  }

  // ã‚µãƒ ãƒã‚¤ãƒ«ä¸€è¦§ã‚’ç”Ÿæˆ
  function createThumbnails(list){
    const wrapper = document.getElementById('thumbnails-wrapper');
    wrapper.innerHTML = '';

    list.forEach((f, i) => {
      const thumb = document.createElement('img');
      thumb.src = f.url;
      thumb.alt = f.name || `thumb-${i+1}`;
      thumb.className = 'thumbnail';
      thumb.dataset.index = i;

      // ã„ã„ã­ã—ãŸç”»åƒã«ã¯ãƒãƒ¼ã‚¯
      if (likedImages.has(i)) {
        thumb.classList.add('liked');
      }

      // ã‚¯ãƒªãƒƒã‚¯ã§è©²å½“ç”»åƒã«ã‚¸ãƒ£ãƒ³ãƒ—
      thumb.onclick = () => jumpToSlide(i);

      wrapper.appendChild(thumb);
    });

    updateActiveThumbnail();
  }

  // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚µãƒ ãƒã‚¤ãƒ«ã‚’æ›´æ–°
  function updateActiveThumbnail(){
    document.querySelectorAll('.thumbnail').forEach((thumb, i) => {
      thumb.classList.toggle('active', i === idx);
      // ã„ã„ã­çŠ¶æ…‹ã‚‚æ›´æ–°
      thumb.classList.toggle('liked', likedImages.has(i));
    });
  }

  // ã‚µãƒ ãƒã‚¤ãƒ«è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
  function toggleThumbnails(){
    thumbnailsVisible = !thumbnailsVisible;
    const container = document.getElementById('thumbnails-container');
    const btn = document.getElementById('thumbnails-toggle');
    const hud = document.getElementById('hud');

    container.classList.toggle('show', thumbnailsVisible);
    hud.classList.toggle('raised', thumbnailsVisible);

    // ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’åˆ‡ã‚Šæ›¿ãˆ
    if (thumbnailsVisible) {
      btn.textContent = 'âœ• é–‰ã˜ã‚‹';
      updateActiveThumbnail();
      // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚µãƒ ãƒã‚¤ãƒ«ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
      const activeThumbnail = document.querySelector('.thumbnail.active');
      if (activeThumbnail) {
        activeThumbnail.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
      }
    } else {
      btn.textContent = 'ğŸ“¸ å†™çœŸä¸€è¦§';
    }
  }

  // æŒ‡å®šã—ãŸã‚¹ãƒ©ã‚¤ãƒ‰ã«ã‚¸ãƒ£ãƒ³ãƒ—
  function jumpToSlide(targetIdx){
    if (slides.length === 0 || targetIdx < 0 || targetIdx >= slides.length) return;

    const wasRunning = running;
    if (running) pause();

    // ç¾åœ¨ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’éè¡¨ç¤º
    const curr = slides[idx];

    // æ–°ã—ã„ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’è¡¨ç¤º
    idx = targetIdx;

    // ã‚¯ãƒ­ã‚¹ãƒ•ã‚§ãƒ¼ãƒ‰
    curr.classList.remove('active');
    slides[idx].classList.add('active');
    updateImageInfo();
    updateActiveThumbnail();

    if (wasRunning) play();
  }

  // ç”»åƒæƒ…å ±ã‚’æ›´æ–°
  function updateImageInfo(){
    document.getElementById('counter').textContent = `${idx + 1} / ${slides.length}`;
    document.getElementById('filename').textContent = fileList[idx]?.name || '-';
    updateLikeButton();
    updateActiveThumbnail();
  }

  // ã„ã„ã­ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºã‚’æ›´æ–°
  function updateLikeButton(){
    const likeBtn = document.getElementById('like-btn');
    const currentLikes = imageLikeCounts[idx] || 0;

    if (likedImages.has(idx)) {
      // ã„ã„ã­æ¸ˆã¿: ç™½ã„ãƒãƒ¼ãƒˆ
      likeBtn.innerHTML = 'ğŸ¤<span id="like-count">' + currentLikes + '</span>';
    } else {
      // æœªã„ã„ã­: ã‚°ãƒ¬ãƒ¼ã®ãƒãƒ¼ãƒˆ
      likeBtn.innerHTML = 'ğŸ©¶<span id="like-count">' + currentLikes + '</span>';
    }
  }

  // ã„ã„ã­æ©Ÿèƒ½
  function toggleLike(){
    const likeBtn = document.getElementById('like-btn');

    if (likedImages.has(idx)) {
      // ã„ã„ã­ã‚’å–ã‚Šæ¶ˆã™
      likedImages.delete(idx);
      imageLikeCounts[idx] = Math.max(0, (imageLikeCounts[idx] || 0) - 1);
    } else {
      // ã„ã„ã­ã‚’è¿½åŠ 
      likedImages.add(idx);
      imageLikeCounts[idx] = (imageLikeCounts[idx] || 0) + 1;
      likeBtn.classList.add('liked');
      setTimeout(() => likeBtn.classList.remove('liked'), 300);
    }

    updateLikeButton();
    updateActiveThumbnail(); // ã‚µãƒ ãƒã‚¤ãƒ«ã‚‚æ›´æ–°

    // LocalStorageã«ä¿å­˜ï¼ˆãƒªãƒ­ãƒ¼ãƒ‰å¾Œã‚‚ç¶­æŒï¼‰
    saveLikesToStorage();
  }

  // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼åˆ‡ã‚Šæ›¿ãˆ
  function filterSlides(filter){
    currentFilter = filter;
    const wasRunning = running;
    if (running) pause();

    // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’æ›´æ–°
    document.getElementById('filter-all').classList.toggle('active', filter === 'all');
    document.getElementById('filter-liked').classList.toggle('active', filter === 'liked');

    if (filter === 'liked') {
      // ã„ã„ã­ã—ãŸå†™çœŸã ã‘ã‚’è¡¨ç¤º
      const likedIndices = Array.from(likedImages);
      if (likedIndices.length === 0) {
        alert('ã¾ã ã„ã„ã­ã—ãŸå†™çœŸãŒã‚ã‚Šã¾ã›ã‚“ã€‚\næ°—ã«å…¥ã£ãŸå†™çœŸã«ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ï¼');
        document.getElementById('filter-all').click();
        return;
      }

      // ã„ã„ã­ã—ãŸå†™çœŸã®ã¿ã«çµã‚Šè¾¼ã¿
      slides = allSlides.filter((_, i) => likedImages.has(i));
      idx = 0;
    } else {
      // å…¨ã¦ã®å†™çœŸã‚’è¡¨ç¤º
      slides = [...allSlides];
      idx = 0;
    }

    // ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’å†è¡¨ç¤º
    document.querySelectorAll('.slide').forEach(s => s.classList.remove('active'));
    if (slides[idx]) {
      slides[idx].classList.add('active');
      updateImageInfo();
    }

    if (wasRunning) play();
  }

  // ã„ã„ã­æƒ…å ±ã‚’LocalStorageã«ä¿å­˜
  function saveLikesToStorage(){
    try {
      localStorage.setItem('tarobo-liked-images', JSON.stringify(Array.from(likedImages)));
      localStorage.setItem('tarobo-like-counts', JSON.stringify(imageLikeCounts));
    } catch(e) {
      console.log('LocalStorageä¿å­˜ã‚¨ãƒ©ãƒ¼:', e);
    }
  }

  // ã„ã„ã­æƒ…å ±ã‚’LocalStorageã‹ã‚‰èª­ã¿è¾¼ã¿
  function loadLikesFromStorage(){
    try {
      const savedLiked = localStorage.getItem('tarobo-liked-images');
      const savedCounts = localStorage.getItem('tarobo-like-counts');

      if (savedLiked) {
        likedImages = new Set(JSON.parse(savedLiked));
      }
      if (savedCounts) {
        imageLikeCounts = JSON.parse(savedCounts);
      }
    } catch(e) {
      console.log('LocalStorageèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
    }
  }

  // SNSã‚·ã‚§ã‚¢æ©Ÿèƒ½ï¼ˆç¾åœ¨è¡¨ç¤ºä¸­ã®ç”»åƒã‚’ã‚·ã‚§ã‚¢ï¼‰
  function shareToSNS(platform){
    if (slides.length === 0) return;

    // ç¾åœ¨è¡¨ç¤ºä¸­ã®ç”»åƒæƒ…å ±ã‚’å–å¾—
    const currentImage = fileList[idx];
    const imageUrl = encodeURIComponent(slides[idx].src);
    const shareText = encodeURIComponent('çŸ³æ®µã‚’é§†ã‘æŠœã‘ã€æœªæ¥ã‚’æ´ã‚€ï½œå¤ªéƒåŠãƒãƒ£ãƒ¬ãƒ³ã‚¸2025\n379æ®µã®æŒ‘æˆ¦è€…ãŸã¡');
    const hashtags = encodeURIComponent('å¤ªéƒåŠãƒãƒ£ãƒ¬ãƒ³ã‚¸');

    let url = '';

    switch(platform) {
      case 'twitter':
        // Twitterã¯ç”»åƒURLã¨ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’å«ã‚ã‚‹
        url = `https://twitter.com/intent/tweet?text=${shareText}&hashtags=${hashtags}&url=${imageUrl}`;
        break;
      case 'facebook':
        // Facebookã¯ç”»åƒURLã‚’å…±æœ‰
        url = `https://www.facebook.com/sharer/sharer.php?u=${imageUrl}`;
        break;
      case 'line':
        // LINEã¯ç”»åƒURLã¨ãƒ†ã‚­ã‚¹ãƒˆã‚’å…±æœ‰
        url = `https://social-plugins.line.me/lineit/share?url=${imageUrl}&text=${shareText}`;
        break;
    }

    if (url) {
      window.open(url, '_blank', 'width=600,height=400');
      // ã‚·ã‚§ã‚¢ã—ãŸã“ã¨ã‚’è¦–è¦šçš„ã«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
      const btn = event.target.closest('.share-btn');
      if (btn) {
        btn.style.transform = 'scale(1.2)';
        setTimeout(() => btn.style.transform = '', 300);
      }
    }
  }

  // ç”»åƒæ‹¡å¤§è¡¨ç¤º
  function openModal(){
    if (slides.length === 0) return;
    const modal = document.getElementById('modal');
    const modalImg = document.getElementById('modal-img');
    modalImg.src = slides[idx].src;
    modal.classList.add('show');
  }

  function closeModal(){
    const modal = document.getElementById('modal');
    modal.classList.remove('show');
  }

  // ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’é©ç”¨
  function applyEffect(element, effect){
    // æ—¢å­˜ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚¯ãƒ©ã‚¹ã‚’ã‚¯ãƒªã‚¢
    element.classList.remove('effect-slide-left', 'effect-slide-right', 'effect-zoom', 'effect-rotate');

    if (effect === 'random') {
      const effects = ['fade', 'slide-left', 'slide-right', 'zoom', 'rotate'];
      effect = effects[Math.floor(Math.random() * effects.length)];
    }

    if (effect !== 'fade') {
      // ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ ï¼ˆactiveã®å‰ã«ï¼‰
      element.classList.add(`effect-${effect}`);
      // ãƒ–ãƒ©ã‚¦ã‚¶ã«åˆæœŸçŠ¶æ…‹ã‚’èªè­˜ã•ã›ã‚‹ãŸã‚ã€å¼·åˆ¶çš„ã«ãƒªãƒ•ãƒ­ãƒ¼
      void element.offsetWidth;
    }
  }

  // é€²æ—ãƒãƒ¼ã‚’æ›´æ–°
  function startProgressBar(){
    if (progressTimer) clearInterval(progressTimer);
    const fill = document.getElementById('progress-fill');
    let progress = 0;
    const step = 100 / (SHOW_MS / 100);

    fill.style.width = '0%';
    progressTimer = setInterval(() => {
      progress += step;
      if (progress >= 100) {
        progress = 0;
      }
      fill.style.width = `${progress}%`;
    }, 100);
  }

  function stopProgressBar(){
    if (progressTimer) {
      clearInterval(progressTimer);
      progressTimer = null;
    }
    document.getElementById('progress-fill').style.width = '0%';
  }


  function play(){
    if (running || slides.length === 0) return;
    running = true;
    if (!slides[idx].classList.contains('active')) {
      slides[idx].classList.add('active');
    }
    updateImageInfo();
    startProgressBar();

    timer = setInterval(()=>{
      const curr = slides[idx];
      idx = (idx + 1) % slides.length;
      const next = slides[idx];

      // ã‚¯ãƒ­ã‚¹ãƒ•ã‚§ãƒ¼ãƒ‰: å‰ã®ç”»åƒã‚’ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆã€æ¬¡ã®ç”»åƒã‚’ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³
      console.log('Transition:', curr, 'to', next); // ãƒ‡ãƒãƒƒã‚°ç”¨
      curr.classList.remove('active');
      next.classList.add('active');
      updateImageInfo();
    }, SHOW_MS);
  }

  function pause(){
    running = false;
    clearInterval(timer);
    timer = null;
    stopProgressBar();
  }

  // æ¬¡ã®ç”»åƒã¸
  function nextSlide(){
    if (slides.length === 0) return;
    const wasRunning = running;
    if (running) pause();

    const curr = slides[idx];
    idx = (idx + 1) % slides.length;
    const next = slides[idx];

    // ã‚¯ãƒ­ã‚¹ãƒ•ã‚§ãƒ¼ãƒ‰
    curr.classList.remove('active');
    next.classList.add('active');
    updateImageInfo();

    if (wasRunning) play();
  }

  // å‰ã®ç”»åƒã¸
  function prevSlide(){
    if (slides.length === 0) return;
    const wasRunning = running;
    if (running) pause();

    const curr = slides[idx];
    idx = (idx - 1 + slides.length) % slides.length;
    const next = slides[idx];

    // ã‚¯ãƒ­ã‚¹ãƒ•ã‚§ãƒ¼ãƒ‰
    curr.classList.remove('active');
    next.classList.add('active');
    updateImageInfo();

    if (wasRunning) play();
  }

  // ã‚¹ãƒ”ãƒ¼ãƒ‰å¤‰æ›´
  function changeSpeed(speed){
    SHOW_MS = SPEEDS[speed];
    currentSpeed = speed;
    document.documentElement.style.setProperty('--show-ms', SHOW_MS);

    // ãƒœã‚¿ãƒ³ã®activeçŠ¶æ…‹ã‚’æ›´æ–°
    document.querySelectorAll('#speed-controls button').forEach(btn => {
      btn.classList.remove('active');
    });
    document.getElementById(`btn-speed-${speed}`).classList.add('active');

    // å†ç”Ÿä¸­ãªã‚‰å†èµ·å‹•
    if (running) {
      pause();
      play();
    }
  }

  async function init(){
    try{
      // LocalStorageã‹ã‚‰ã„ã„ã­æƒ…å ±ã‚’èª­ã¿è¾¼ã¿
      loadLikesFromStorage();

      const {all, pick} = await fetchList();
      createSlides(pick);
      document.getElementById('info').textContent = `source=${all} / showing=${pick.length}`;
      play();
    }catch(e){
      document.getElementById('info').textContent = 'èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ';
      console.error(e);
    }
  }

  // BGMæ©Ÿèƒ½
  function initBGM(){
    bgmAudio = document.getElementById('bgm-audio');
    bgmAudio.volume = 0.5;

    document.getElementById('bgm-toggle').onclick = () => {
      const btn = document.getElementById('bgm-toggle');
      if (bgmAudio.paused) {
        bgmAudio.play().catch(e => console.log('BGMå†ç”Ÿã‚¨ãƒ©ãƒ¼:', e));
        btn.classList.add('playing');
        btn.textContent = 'ğŸµ BGMåœæ­¢';
      } else {
        bgmAudio.pause();
        btn.classList.remove('playing');
        btn.textContent = 'ğŸµ BGM';
      }
    };

    document.getElementById('bgm-volume').oninput = (e) => {
      bgmAudio.volume = e.target.value / 100;
    };
  }

  // ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
  document.getElementById('btn-play').onclick = play;
  document.getElementById('btn-pause').onclick = pause;
  document.getElementById('btn-refresh').onclick = () => { pause(); init(); };

  // ã‚¹ãƒ”ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³
  document.getElementById('btn-speed-slow').onclick = () => changeSpeed('slow');
  document.getElementById('btn-speed-normal').onclick = () => changeSpeed('normal');
  document.getElementById('btn-speed-fast').onclick = () => changeSpeed('fast');

  // ã„ã„ã­ãƒœã‚¿ãƒ³
  document.getElementById('like-btn').onclick = toggleLike;

  // SNSã‚·ã‚§ã‚¢ãƒœã‚¿ãƒ³
  document.getElementById('share-twitter').onclick = () => shareToSNS('twitter');
  document.getElementById('share-facebook').onclick = () => shareToSNS('facebook');
  document.getElementById('share-line').onclick = () => shareToSNS('line');

  // ãƒ¢ãƒ¼ãƒ€ãƒ«
  document.getElementById('modal').onclick = closeModal;
  document.getElementById('modal-close').onclick = closeModal;

  // ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé¸æŠ
  document.getElementById('effect-select').onchange = (e) => {
    currentEffect = e.target.value;
  };

  // ã‚µãƒ ãƒã‚¤ãƒ«è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
  document.getElementById('thumbnails-toggle').onclick = toggleThumbnails;

  // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒœã‚¿ãƒ³
  document.getElementById('filter-all').onclick = () => filterSlides('all');
  document.getElementById('filter-liked').onclick = () => filterSlides('liked');

  // ã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°ç”»é¢
  function initOpening(){
    const opening = document.getElementById('opening');

    // ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³
    document.getElementById('opening-start').onclick = () => {
      opening.classList.add('hide');
      setTimeout(() => opening.style.display = 'none', 800);
    };

    // Skipãƒœã‚¿ãƒ³
    document.getElementById('opening-skip').onclick = () => {
      opening.classList.add('hide');
      setTimeout(() => opening.style.display = 'none', 800);
    };
  }

  // ãƒ˜ãƒ«ãƒ—ãƒœã‚¿ãƒ³
  let helpVisible = false;

  document.getElementById('help-btn').onclick = () => {
    helpVisible = !helpVisible;
    const panel = document.getElementById('help-panel');
    panel.classList.toggle('show', helpVisible);

    // Aboutãƒ‘ãƒãƒ«ãŒé–‹ã„ã¦ã„ãŸã‚‰é–‰ã˜ã‚‹
    if (helpVisible && aboutVisible) {
      aboutVisible = false;
      document.getElementById('about-panel').classList.remove('show');
    }
  };

  // ãƒ˜ãƒ«ãƒ—ãƒ‘ãƒãƒ«å¤–ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰é–‰ã˜ã‚‹
  document.addEventListener('click', (e) => {
    const helpBtn = document.getElementById('help-btn');
    const helpPanel = document.getElementById('help-panel');
    const aboutBtn = document.getElementById('about-btn');
    const aboutPanel = document.getElementById('about-panel');

    if (helpVisible && !helpBtn.contains(e.target) && !helpPanel.contains(e.target)) {
      helpVisible = false;
      helpPanel.classList.remove('show');
    }

    if (aboutVisible && !aboutBtn.contains(e.target) && !aboutPanel.contains(e.target)) {
      aboutVisible = false;
      aboutPanel.classList.remove('show');
    }
  });

  // Aboutãƒœã‚¿ãƒ³
  let aboutVisible = false;

  document.getElementById('about-btn').onclick = () => {
    aboutVisible = !aboutVisible;
    const panel = document.getElementById('about-panel');
    panel.classList.toggle('show', aboutVisible);

    // ãƒ˜ãƒ«ãƒ—ãƒ‘ãƒãƒ«ãŒé–‹ã„ã¦ã„ãŸã‚‰é–‰ã˜ã‚‹
    if (aboutVisible && helpVisible) {
      helpVisible = false;
      document.getElementById('help-panel').classList.remove('show');
    }
  };

  // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œ
  document.addEventListener('keydown', (e) => {
    switch(e.key) {
      case ' ':           // ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼: ä¸€æ™‚åœæ­¢/å†ç”Ÿ
        e.preventDefault();
        if (running) pause();
        else play();
        break;
      case 'ArrowRight':  // å³çŸ¢å°: æ¬¡ã®ç”»åƒ
        e.preventDefault();
        nextSlide();
        break;
      case 'ArrowLeft':   // å·¦çŸ¢å°: å‰ã®ç”»åƒ
        e.preventDefault();
        prevSlide();
        break;
      case 'ArrowUp':     // ä¸ŠçŸ¢å°: é€Ÿåº¦ã‚¢ãƒƒãƒ—
        e.preventDefault();
        if (currentSpeed === 'slow') changeSpeed('normal');
        else if (currentSpeed === 'normal') changeSpeed('fast');
        break;
      case 'ArrowDown':   // ä¸‹çŸ¢å°: é€Ÿåº¦ãƒ€ã‚¦ãƒ³
        e.preventDefault();
        if (currentSpeed === 'fast') changeSpeed('normal');
        else if (currentSpeed === 'normal') changeSpeed('slow');
        break;
      case 'l':           // Lã‚­ãƒ¼: ã„ã„ã­
        e.preventDefault();
        toggleLike();
        break;
      case 'Enter':       // Enterã‚­ãƒ¼: ç”»åƒæ‹¡å¤§
        e.preventDefault();
        if (!document.getElementById('modal').classList.contains('show')) {
          openModal();
        } else {
          closeModal();
        }
        break;
      case 'Escape':      // Escã‚­ãƒ¼: ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        e.preventDefault();
        closeModal();
        break;
      case 't':           // Tã‚­ãƒ¼: ã‚µãƒ ãƒã‚¤ãƒ«è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        e.preventDefault();
        toggleThumbnails();
        break;
      case 'f':           // Fã‚­ãƒ¼: ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼åˆ‡ã‚Šæ›¿ãˆ
        e.preventDefault();
        if (currentFilter === 'all') {
          filterSlides('liked');
        } else {
          filterSlides('all');
        }
        break;
    }
  });

  // ç”»åƒã‚¯ãƒªãƒƒã‚¯ã§æ‹¡å¤§è¡¨ç¤º
  const stage = document.getElementById('stage');
  stage.addEventListener('click', (e) => {
    // ã‚·ãƒ³ã‚°ãƒ«ã‚¯ãƒªãƒƒã‚¯ã§æ‹¡å¤§è¡¨ç¤º
    if (e.detail === 1) {
      setTimeout(() => {
        if (e.detail === 1) openModal();
      }, 200);
    }
  });

  // ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯/ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ã§ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³
  stage.addEventListener('dblclick', ()=> {
    if (!document.fullscreenElement) stage.requestFullscreen().catch(()=>{});
    else document.exitFullscreen().catch(()=>{});
  });

  // åˆæœŸåŒ–
  initOpening();
  initBGM();
  init();
  </script>
</body>
</html>
